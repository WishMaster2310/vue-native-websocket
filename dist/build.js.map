{"version":3,"file":"build.js","mappings":"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","sources":["webpack://VueNativeSock/webpack/universalModuleDefinition","webpack://VueNativeSock/webpack/bootstrap","webpack://VueNativeSock/webpack/runtime/define property getters","webpack://VueNativeSock/webpack/runtime/hasOwnProperty shorthand","webpack://VueNativeSock/webpack/runtime/make namespace object","webpack://VueNativeSock/./src/Emitter.js","webpack://VueNativeSock/./src/Observer.js","webpack://VueNativeSock/./src/Main.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VueNativeSock\"] = factory();\n\telse\n\t\troot[\"VueNativeSock\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","class Emitter {\n  constructor () {\n    this.listeners = new Map()\n  }\n\n  addListener (label, callback, vm) {\n    if (typeof callback === 'function') {\n      this.listeners.has(label) || this.listeners.set(label, [])\n      this.listeners.get(label).push({ callback, vm })\n      return true\n    }\n    return false\n  }\n\n  removeListener (label, callback, vm) {\n    const listeners = this.listeners.get(label)\n    let index\n\n    if (listeners && listeners.length) {\n      index = listeners.reduce((i, listener, index) => {\n        if (typeof listener.callback === 'function' && listener.callback === callback && listener.vm === vm) {\n          i = index\n        }\n        return i\n      }, -1)\n\n      if (index > -1) {\n        listeners.splice(index, 1)\n        this.listeners.set(label, listeners)\n        return true\n      }\n    }\n    return false\n  }\n\n  emit (label, ...args) {\n    const listeners = this.listeners.get(label)\n\n    if (listeners && listeners.length) {\n      listeners.forEach((listener) => {\n        listener.callback.call(listener.vm, ...args)\n      })\n      return true\n    }\n    return false\n  }\n}\n\nexport default new Emitter()\n","import Emitter from './Emitter'\n\nexport default class {\n  constructor (connectionUrl, opts = {}) {\n    this.format = opts.format && opts.format.toLowerCase()\n\n    if (connectionUrl.startsWith('//')) {\n      const scheme = window.location.protocol === 'https:' ? 'wss' : 'ws'\n      connectionUrl = `${scheme}:${connectionUrl}`\n    }\n\n    this.connectionUrl = connectionUrl\n    this.opts = opts\n\n    this.reconnection = this.opts.reconnection || false\n    this.reconnectionAttempts = this.opts.reconnectionAttempts || Infinity\n    this.reconnectionDelay = this.opts.reconnectionDelay || 1000\n    this.reconnectTimeoutId = 0\n    this.reconnectionCount = 0\n\n    this.passToStoreHandler = this.opts.passToStoreHandler || false\n\n    this.connect(connectionUrl, opts)\n\n    if (opts.store) { this.store = opts.store }\n    if (opts.mutations) { this.mutations = opts.mutations }\n    this.onEvent()\n  }\n\n  connect (connectionUrl, opts = {}) {\n    const protocol = opts.protocol || ''\n    this.WebSocket = opts.WebSocket || (protocol === '' ? new WebSocket(connectionUrl) : new WebSocket(connectionUrl, protocol))\n    if (this.format === 'json') {\n      if (!('sendObj' in this.WebSocket)) {\n        this.WebSocket.sendObj = (obj) => this.WebSocket.send(JSON.stringify(obj))\n      }\n    }\n\n    return this.WebSocket\n  }\n\n  reconnect () {\n    if (this.reconnectionCount <= this.reconnectionAttempts) {\n      this.reconnectionCount++\n      clearTimeout(this.reconnectTimeoutId)\n\n      this.reconnectTimeoutId = setTimeout(() => {\n        if (this.store) { this.passToStore('SOCKET_RECONNECT', this.reconnectionCount) }\n\n        this.connect(this.connectionUrl, this.opts)\n        this.onEvent()\n      }, this.reconnectionDelay)\n    } else {\n      if (this.store) { this.passToStore('SOCKET_RECONNECT_ERROR', true) }\n    }\n  }\n\n  onEvent () {\n    ['onmessage', 'onclose', 'onerror', 'onopen'].forEach((eventType) => {\n      this.WebSocket[eventType] = (event) => {\n        Emitter.emit(eventType, event)\n\n        if (this.store) { this.passToStore('SOCKET_' + eventType, event) }\n\n        if (this.reconnection && eventType === 'onopen') {\n          this.opts.$setInstance(event.currentTarget)\n          this.reconnectionCount = 0\n        }\n\n        if (this.reconnection && eventType === 'onclose') { this.reconnect() }\n      }\n    })\n  }\n\n  passToStore (eventName, event) {\n    if (this.passToStoreHandler) {\n      this.passToStoreHandler(eventName, event, this.defaultPassToStore.bind(this))\n    } else {\n      this.defaultPassToStore(eventName, event)\n    }\n  }\n\n  defaultPassToStore (eventName, event) {\n    if (!eventName.startsWith('SOCKET_')) { return }\n    let method = 'commit'\n    let target = eventName.toUpperCase()\n    let msg = event\n    if (this.format === 'json' && event.data) {\n      msg = JSON.parse(event.data)\n      if (msg.mutation) {\n        target = [msg.namespace || '', msg.mutation].filter((e) => !!e).join('/')\n      } else if (msg.action) {\n        method = 'dispatch'\n        target = [msg.namespace || '', msg.action].filter((e) => !!e).join('/')\n      }\n    }\n    if (this.mutations) {\n      target = this.mutations[target] || target\n    }\n    this.store[method](target, msg)\n  }\n}\n","import Observer from './Observer'\nimport Emitter from './Emitter'\n\nexport default {\n\n  install (Vue, connection, opts = {}) {\n    if (!connection && !opts.connectManually) { throw new Error('[vue-native-socket] cannot locate connection') }\n\n    let observer = null\n\n    opts.$setInstance = (wsInstance) => {\n      Vue.prototype.$socket = wsInstance\n    }\n\n    if (opts.connectManually) {\n      Vue.prototype.$connect = (connectionUrl = connection, connectionOpts = opts) => {\n        connectionOpts.$setInstance = opts.$setInstance\n        observer = new Observer(connectionUrl, connectionOpts)\n        Vue.prototype.$socket = observer.WebSocket\n      }\n\n      Vue.prototype.$disconnect = () => {\n        if (observer && observer.reconnection) { observer.reconnection = false }\n        if (Vue.prototype.$socket) {\n          Vue.prototype.$socket.close()\n          delete Vue.prototype.$socket\n        }\n      }\n    } else {\n      observer = new Observer(connection, opts)\n      Vue.prototype.$socket = observer.WebSocket\n    }\n    const hasProxy = typeof Proxy !== 'undefined' && typeof Proxy === 'function' && /native code/.test(Proxy.toString())\n\n    Vue.mixin({\n      created () {\n        const vm = this\n        const sockets = this.$options.sockets\n\n        if (hasProxy) {\n          this.$options.sockets = new Proxy({}, {\n            set (target, key, value) {\n              Emitter.addListener(key, value, vm)\n              target[key] = value\n              return true\n            },\n            deleteProperty (target, key) {\n              Emitter.removeListener(key, vm.$options.sockets[key], vm)\n              delete target.key\n              return true\n            }\n          })\n          if (sockets) {\n            Object.keys(sockets).forEach((key) => {\n              this.$options.sockets[key] = sockets[key]\n            })\n          }\n        } else {\n          Object.seal(this.$options.sockets)\n\n          // if !hasProxy need addListener\n          if (sockets) {\n            Object.keys(sockets).forEach(key => {\n              Emitter.addListener(key, sockets[key], vm)\n            })\n          }\n        }\n      },\n      beforeDestroy () {\n        if (hasProxy) {\n          const sockets = this.$options.sockets\n\n          if (sockets) {\n            Object.keys(sockets).forEach((key) => {\n              delete this.$options.sockets[key]\n            })\n          }\n        }\n      }\n    })\n  }\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","Emitter","this","listeners","Map","label","callback","vm","has","set","push","index","length","reduce","i","listener","splice","args","forEach","connectionUrl","opts","format","toLowerCase","startsWith","scheme","window","location","protocol","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectTimeoutId","reconnectionCount","passToStoreHandler","connect","store","mutations","onEvent","WebSocket","sendObj","send","JSON","stringify","clearTimeout","setTimeout","passToStore","eventType","event","$setInstance","currentTarget","reconnect","eventName","defaultPassToStore","bind","method","target","toUpperCase","msg","data","parse","mutation","namespace","filter","e","join","action","install","Vue","connection","connectManually","Error","observer","wsInstance","$socket","$connect","connectionOpts","Observer","$disconnect","close","hasProxy","Proxy","test","toString","mixin","created","sockets","$options","deleteProperty","keys","seal","beforeDestroy"],"sourceRoot":""}